# 部署知识完全指南

## 📚 目录

1. [部署基础概念](#部署基础概念)
2. [云服务器选择](#云服务器选择)
3. [Linux 基础操作](#linux-基础操作)
4. [宝塔面板部署](#宝塔面板部署)
5. [Docker 部署](#docker-部署)
6. [传统部署方式](#传统部署方式)
7. [部署方案对比](#部署方案对比)
8. [实战部署流程](#实战部署流程)

---

## 部署基础概念

### 什么是部署？

**部署（Deployment）** 是将开发好的应用程序发布到服务器上，让用户可以通过互联网访问的过程。

### 部署的组成部分

```
用户浏览器
    ↓
  互联网
    ↓
云服务器（Linux系统）
    ↓
├── Nginx（反向代理/静态资源服务器）
├── 后端服务（Spring Boot）
├── 前端服务（Vue打包后的静态文件）
├── 数据库（MySQL）
└── 缓存（Redis）
```

---

## 云服务器选择

### 主流云服务商对比

| 服务商 | 优势 | 适合场景 | 价格 |
|--------|------|----------|------|
| **阿里云** | 国内访问快，文档丰富 | 国内项目，企业级 | 中等 |
| **腾讯云** | 性价比高，学生优惠 | 个人/小团队 | 较低 |
| **华为云** | 企业级服务 | 大型企业 | 较高 |
| **AWS** | 全球服务，功能强大 | 国际化项目 | 较高 |
| **Azure** | 微软生态 | 企业级 | 较高 |

### 服务器配置选择建议

#### 个人项目/学习
- **CPU**: 1-2核
- **内存**: 2-4GB
- **带宽**: 1-3Mbps
- **硬盘**: 40GB SSD
- **价格**: 约 50-200元/月

#### 小型项目/团队
- **CPU**: 2-4核
- **内存**: 4-8GB
- **带宽**: 3-5Mbps
- **硬盘**: 80GB SSD
- **价格**: 约 200-500元/月

#### 生产环境
- **CPU**: 4核以上
- **内存**: 8GB以上
- **带宽**: 5Mbps以上
- **硬盘**: 100GB+ SSD
- **价格**: 500元/月起

### 购买服务器后的第一步

1. **选择操作系统**
   - Ubuntu 20.04/22.04 LTS（推荐，易用）
   - CentOS 7/8（稳定，但已停止更新）
   - Debian（轻量，稳定）

2. **获取服务器信息**
   - IP地址：`123.456.789.012`
   - 用户名：`root` 或 `ubuntu`
   - 密码：购买时设置或通过密钥登录

3. **连接服务器**
   ```bash
   # Windows 使用 PowerShell 或 CMD
   ssh root@你的服务器IP
   
   # 或使用工具：PuTTY、Xshell、MobaXterm
   ```

---

## Linux 基础操作

### 常用命令

```bash
# 查看当前目录
pwd

# 列出文件
ls -la

# 进入目录
cd /home

# 创建目录
mkdir project

# 删除文件/目录
rm file.txt
rm -rf directory

# 查看文件内容
cat file.txt
less file.txt

# 编辑文件（使用 vim）
vim file.txt
# 按 i 进入编辑模式
# 按 Esc 退出编辑
# 输入 :wq 保存并退出
# 输入 :q! 不保存退出

# 查看进程
ps aux
top

# 查看端口占用
netstat -tlnp
# 或
ss -tlnp

# 查看系统资源
free -h        # 内存
df -h          # 磁盘
```

### 文件权限

```bash
# 修改文件权限
chmod 755 file.sh    # 所有者可读写执行，其他只读执行
chmod +x script.sh   # 添加执行权限

# 修改文件所有者
chown user:group file.txt
```

### 服务管理（systemd）

```bash
# 启动服务
systemctl start nginx

# 停止服务
systemctl stop nginx

# 重启服务
systemctl restart nginx

# 查看服务状态
systemctl status nginx

# 设置开机自启
systemctl enable nginx

# 禁用开机自启
systemctl disable nginx
```

### 防火墙配置

```bash
# Ubuntu/Debian
ufw allow 80/tcp      # 开放 HTTP 端口
ufw allow 443/tcp    # 开放 HTTPS 端口
ufw allow 22/tcp     # 开放 SSH 端口
ufw enable           # 启用防火墙

# CentOS/RHEL
firewall-cmd --permanent --add-port=80/tcp
firewall-cmd --permanent --add-port=443/tcp
firewall-cmd --reload
```

---

## 宝塔面板部署

### 什么是宝塔面板？

**宝塔面板** 是一个 Linux 服务器管理面板，通过图形化界面管理服务器，无需记忆复杂命令。

### 安装宝塔面板

#### 1. 连接服务器并安装

```bash
# CentOS/RedHat
yum install -y wget && wget -O install.sh http://download.bt.cn/install/install_6.0.sh && sh install.sh

# Ubuntu/Debian
wget -O install.sh http://download.bt.cn/install/install-ubuntu_6.0.sh && sudo bash install.sh
```

#### 2. 安装完成后获取信息

```
外网面板地址: http://你的IP:8888/随机字符串
内网面板地址: http://内网IP:8888/随机字符串
username: 用户名
password: 密码
```

#### 3. 登录面板并安装软件

在浏览器访问面板地址，登录后：

1. **安装运行环境**
   - Nginx（Web服务器）
   - MySQL（数据库）
   - PHP（如果后端是PHP）
   - Java（Spring Boot需要）
   - Redis（缓存）

2. **创建网站**
   - 点击"网站" → "添加站点"
   - 输入域名（或IP）
   - 选择PHP版本（如果不需要可以选纯静态）

3. **上传文件**
   - 方式1：通过面板的文件管理器上传
   - 方式2：使用FTP工具（FileZilla）
   - 方式3：使用Git克隆项目

### 宝塔部署你的项目

#### 步骤1：安装必要软件

```
软件商店 → 安装：
- Nginx 1.20+
- MySQL 5.7+
- Redis 6.0+
- Java 17（Spring Boot 3需要）
```

#### 步骤2：创建数据库

```
数据库 → 添加数据库
- 数据库名：travel_db
- 用户名：travel_user
- 密码：设置强密码
```

#### 步骤3：部署后端

1. **上传后端文件**
   ```bash
   # 在服务器上
   cd /www/wwwroot
   mkdir travel-server
   cd travel-server
   # 上传你的 travel-server.jar 文件
   ```

2. **创建启动脚本**
   ```bash
   vim /www/wwwroot/travel-server/start.sh
   ```
   
   内容：
   ```bash
   #!/bin/bash
   cd /www/wwwroot/travel-server
   nohup java -jar -Xms512m -Xmx1024m travel-server.jar \
     --spring.profiles.active=prod \
     > server.log 2>&1 &
   echo $! > server.pid
   ```

3. **设置权限并启动**
   ```bash
   chmod +x start.sh
   ./start.sh
   ```

#### 步骤4：部署前端

1. **构建前端**
   ```bash
   # 在本地
   cd travel-admin
   npm run build
   # 生成 dist 目录
   ```

2. **上传到服务器**
   - 将 `dist` 目录内容上传到 `/www/wwwroot/travel-admin`

3. **配置 Nginx**
   
   在宝塔面板：网站 → 你的网站 → 设置 → 配置文件
   
   ```nginx
   server {
       listen 80;
       server_name 你的域名或IP;
       
       # 前端静态文件
       location / {
           root /www/wwwroot/travel-admin;
           index index.html;
           try_files $uri $uri/ /index.html;
       }
       
       # 后端API代理
       location /api/ {
           proxy_pass http://127.0.0.1:8070;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
       }
       
       # 上传文件
       location /upload/ {
           alias /www/wwwroot/travel-server/upload/;
           expires 30d;
       }
   }
   ```

#### 步骤5：配置环境变量

在宝塔面板：网站 → 你的网站 → 设置 → 环境变量

或创建配置文件：
```bash
vim /www/wwwroot/travel-server/application-prod.yml
```

### 宝塔面板优缺点

**优点：**
- ✅ 图形化界面，操作简单
- ✅ 一键安装软件
- ✅ 可视化管理文件
- ✅ 自动备份功能
- ✅ 适合新手

**缺点：**
- ❌ 占用一定服务器资源
- ❌ 安全性需要额外配置
- ❌ 不适合大规模集群

---

## Docker 部署

### 什么是 Docker？

**Docker** 是一个容器化平台，可以将应用和依赖打包成容器，在任何支持 Docker 的环境中运行。

### Docker 核心概念

```
镜像（Image）     → 应用的模板（类似安装包）
容器（Container） → 镜像的运行实例（类似运行的程序）
仓库（Repository）→ 存放镜像的地方（类似应用商店）
```

### 安装 Docker

```bash
# Ubuntu/Debian
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# 启动 Docker
sudo systemctl start docker
sudo systemctl enable docker

# 验证安装
docker --version
```

### Docker 基础命令

```bash
# 查看镜像
docker images

# 查看容器
docker ps              # 运行中的
docker ps -a           # 所有容器

# 运行容器
docker run -d -p 8080:8080 nginx

# 停止容器
docker stop 容器ID

# 删除容器
docker rm 容器ID

# 删除镜像
docker rmi 镜像名

# 查看日志
docker logs 容器ID

# 进入容器
docker exec -it 容器ID /bin/bash
```

### Dockerfile 编写

#### 后端 Dockerfile

```dockerfile
# travel-server/Dockerfile
FROM openjdk:17-jdk-slim

# 设置工作目录
WORKDIR /app

# 复制jar包
COPY target/travel-server.jar app.jar

# 暴露端口
EXPOSE 8070

# 启动命令
ENTRYPOINT ["java", "-jar", "app.jar", "--spring.profiles.active=prod"]
```

#### 前端 Dockerfile

```dockerfile
# travel-admin/Dockerfile
# 构建阶段
FROM node:18-alpine as builder
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

# 运行阶段
FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

### Docker Compose 部署

创建 `docker-compose.yml`：

```yaml
version: '3.8'

services:
  # MySQL 数据库
  mysql:
    image: mysql:8.0
    container_name: travel-mysql
    environment:
      MYSQL_ROOT_PASSWORD: root_password
      MYSQL_DATABASE: travel_db
      MYSQL_USER: travel_user
      MYSQL_PASSWORD: travel_password
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
    restart: always

  # Redis 缓存
  redis:
    image: redis:7-alpine
    container_name: travel-redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    restart: always

  # 后端服务
  backend:
    build: ./travel-server
    container_name: travel-backend
    ports:
      - "8070:8070"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - DB_HOST=mysql
      - DB_PORT=3306
      - DB_NAME=travel_db
      - DB_USER=travel_user
      - DB_PASSWORD=travel_password
      - REDIS_HOST=redis
      - REDIS_PORT=6379
    depends_on:
      - mysql
      - redis
    restart: always

  # 前端服务
  frontend:
    build: ./travel-admin
    container_name: travel-frontend
    ports:
      - "80:80"
    depends_on:
      - backend
    restart: always

volumes:
  mysql_data:
  redis_data:
```

### 使用 Docker Compose 部署

```bash
# 构建并启动所有服务
docker-compose up -d

# 查看运行状态
docker-compose ps

# 查看日志
docker-compose logs -f

# 停止所有服务
docker-compose down

# 停止并删除数据卷
docker-compose down -v
```

### Docker 优缺点

**优点：**
- ✅ 环境一致，开发=生产
- ✅ 快速部署和扩展
- ✅ 资源隔离，安全
- ✅ 易于版本管理
- ✅ 适合微服务架构

**缺点：**
- ❌ 学习曲线较陡
- ❌ 需要理解容器概念
- ❌ 调试相对复杂

---

## 传统部署方式

### 手动部署流程

#### 1. 服务器准备

```bash
# 更新系统
apt update && apt upgrade -y  # Ubuntu/Debian
yum update -y                 # CentOS

# 安装必要软件
apt install -y openjdk-17-jdk mysql-server redis-server nginx
```

#### 2. 配置数据库

```bash
# 登录 MySQL
mysql -u root -p

# 创建数据库
CREATE DATABASE travel_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'travel_user'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON travel_db.* TO 'travel_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

#### 3. 部署后端

```bash
# 创建目录
mkdir -p /opt/travel-server
cd /opt/travel-server

# 上传 jar 文件（使用 scp 或 FTP）
# scp travel-server.jar root@服务器IP:/opt/travel-server/

# 创建启动脚本
cat > start.sh << 'EOF'
#!/bin/bash
cd /opt/travel-server
nohup java -jar -Xms512m -Xmx1024m travel-server.jar \
  --spring.profiles.active=prod \
  > server.log 2>&1 &
echo $! > server.pid
EOF

chmod +x start.sh
./start.sh
```

#### 4. 配置 Nginx

```bash
# 编辑 Nginx 配置
vim /etc/nginx/sites-available/travel

# 配置内容（见下方）
# 创建软链接
ln -s /etc/nginx/sites-available/travel /etc/nginx/sites-enabled/

# 测试配置
nginx -t

# 重启 Nginx
systemctl restart nginx
```

Nginx 配置：

```nginx
server {
    listen 80;
    server_name 你的域名或IP;

    # 前端
    location / {
        root /opt/travel-admin;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # 后端API
    location /api/ {
        proxy_pass http://127.0.0.1:8070;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # 上传文件
    location /upload/ {
        alias /opt/travel-server/upload/;
        expires 30d;
    }
}
```

#### 5. 设置开机自启

```bash
# 创建 systemd 服务
cat > /etc/systemd/system/travel-server.service << 'EOF'
[Unit]
Description=Travel Server Application
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/opt/travel-server
ExecStart=/usr/bin/java -jar -Xms512m -Xmx1024m travel-server.jar --spring.profiles.active=prod
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# 启用服务
systemctl daemon-reload
systemctl enable travel-server
systemctl start travel-server
```

---

## 部署方案对比

| 方案 | 难度 | 适用场景 | 优点 | 缺点 |
|------|------|----------|------|------|
| **宝塔面板** | ⭐⭐ | 个人项目、小团队 | 图形化、易用 | 占用资源、安全性需注意 |
| **Docker** | ⭐⭐⭐⭐ | 生产环境、微服务 | 环境一致、易扩展 | 学习成本高 |
| **传统部署** | ⭐⭐⭐ | 简单项目、学习 | 完全控制、轻量 | 配置复杂 |

### 推荐选择

- **新手/个人项目** → 宝塔面板
- **生产环境/团队** → Docker
- **学习/简单项目** → 传统部署

---

## 实战部署流程

### 方案一：宝塔面板部署（推荐新手）

#### 准备工作

1. 购买云服务器（腾讯云/阿里云）
2. 选择 Ubuntu 22.04 系统
3. 开放端口：80, 443, 8070, 3306, 6379

#### 部署步骤

1. **安装宝塔面板**
   ```bash
   wget -O install.sh http://download.bt.cn/install/install-ubuntu_6.0.sh
   sudo bash install.sh
   ```

2. **登录面板，安装软件**
   - Nginx
   - MySQL 8.0
   - Redis 7.0
   - Java 17

3. **创建数据库**
   - 数据库名：`travel_db`
   - 用户名：`travel_user`
   - 密码：设置强密码

4. **上传后端文件**
   - 在面板文件管理中上传 `travel-server.jar`
   - 创建启动脚本

5. **构建并上传前端**
   ```bash
   # 本地执行
   cd travel-admin
   npm run build
   # 上传 dist 目录内容到服务器
   ```

6. **配置 Nginx**
   - 在面板中创建网站
   - 配置反向代理

7. **配置环境变量**
   - 在 `application-prod.yml` 中配置数据库、Redis等

### 方案二：Docker 部署（推荐生产）

#### 准备工作

1. 服务器安装 Docker 和 Docker Compose
2. 准备 Dockerfile 和 docker-compose.yml

#### 部署步骤

1. **构建镜像**
   ```bash
   # 后端
   cd travel-server
   docker build -t travel-backend .
   
   # 前端
   cd travel-admin
   docker build -t travel-frontend .
   ```

2. **使用 Docker Compose**
   ```bash
   docker-compose up -d
   ```

3. **查看日志**
   ```bash
   docker-compose logs -f
   ```

### 方案三：传统部署（学习用）

按照"传统部署方式"章节的步骤操作。

---

## 常见问题

### 1. 端口被占用

```bash
# 查看端口占用
netstat -tlnp | grep 8070
# 或
lsof -i:8070

# 杀死进程
kill -9 进程ID
```

### 2. 服务无法启动

```bash
# 查看日志
tail -f /opt/travel-server/server.log

# 检查 Java 版本
java -version

# 检查端口是否开放
ufw status
```

### 3. 数据库连接失败

- 检查数据库是否启动：`systemctl status mysql`
- 检查用户权限
- 检查防火墙规则
- 检查配置文件中的数据库地址

### 4. 前端页面空白

- 检查 Nginx 配置
- 检查静态文件路径
- 查看浏览器控制台错误
- 检查 API 代理配置

---

## 安全建议

1. **修改默认端口**
   - SSH 端口改为非 22
   - 数据库端口改为非 3306

2. **使用密钥登录**
   - 禁用密码登录
   - 使用 SSH 密钥

3. **定期更新**
   ```bash
   apt update && apt upgrade
   ```

4. **配置防火墙**
   - 只开放必要端口
   - 使用 fail2ban 防止暴力破解

5. **使用 HTTPS**
   - 申请 SSL 证书（Let's Encrypt 免费）
   - 配置 Nginx SSL

---

## 监控和维护

### 监控工具

- **宝塔面板**：自带监控
- **Docker**：`docker stats`
- **系统监控**：`htop`、`iotop`

### 日志管理

```bash
# 查看应用日志
tail -f /opt/travel-server/server.log

# 查看 Nginx 日志
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log

# 日志轮转（防止日志过大）
logrotate
```

### 备份策略

1. **数据库备份**
   ```bash
   mysqldump -u root -p travel_db > backup.sql
   ```

2. **文件备份**
   - 使用宝塔自动备份
   - 或使用 rsync 同步

3. **定期备份**
   - 设置 cron 定时任务
   - 备份到云存储

---

## 总结

### 快速选择指南

- **完全新手** → 宝塔面板
- **有一定基础** → Docker
- **想深入学习** → 传统部署

### 学习路径

1. 先学会 Linux 基础命令
2. 尝试宝塔面板部署
3. 学习 Docker 基础
4. 掌握传统部署方式
5. 根据项目需求选择方案

### 推荐资源

- **Linux 学习**：鸟哥的 Linux 私房菜
- **Docker 学习**：Docker 官方文档
- **Nginx 学习**：Nginx 官方文档
- **宝塔面板**：宝塔官方文档

---

**记住：部署是一个实践过程，多动手操作，遇到问题就查资料，慢慢就熟练了！** 🚀





































