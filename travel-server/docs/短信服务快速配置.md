# 短信服务快速配置指南

## 快速开始（5分钟配置）

### 步骤1：获取阿里云AccessKey
1. 登录 [阿里云控制台](https://home.console.aliyun.com/)
2. 鼠标悬停右上角头像 → **AccessKey管理**
3. 创建AccessKey，获取：
   - AccessKey ID
   - AccessKey Secret

### 步骤2：申请短信签名和模板
1. 进入 [短信服务控制台](https://dysms.console.aliyun.com/)
2. **签名管理** → 添加签名：
   - 签名名称：`智慧生态旅游平台`
   - 等待审核通过（1-2个工作日）
3. **模板管理** → 添加模板：
   - 模板类型：验证码
   - 模板内容：`您的验证码是${code}，5分钟内有效，请勿泄露给他人。`
   - 等待审核通过（1-2个工作日）
4. 获取模板代码（格式：`SMS_123456789`）

### 步骤3：配置系统

**方式一：环境变量（推荐）**

在启动应用前设置环境变量：

**Windows:**
```cmd
set ALIYUN_SMS_ACCESS_KEY_ID=your-access-key-id
set ALIYUN_SMS_ACCESS_KEY_SECRET=your-access-key-secret
set ALIYUN_SMS_TEMPLATE_CODE=SMS_123456789
```

**Linux/Mac:**
```bash
export ALIYUN_SMS_ACCESS_KEY_ID="your-access-key-id"
export ALIYUN_SMS_ACCESS_KEY_SECRET="your-access-key-secret"
export ALIYUN_SMS_TEMPLATE_CODE="SMS_123456789"
```

**方式二：修改配置文件**

编辑 `travel-server/src/main/resources/application-dev.yml`：

```yaml
aliyun:
  sms:
    enabled: true
    access-key-id: your-access-key-id
    access-key-secret: your-access-key-secret
    sign-name: 智慧生态旅游平台
    template-code: SMS_123456789
```

### 步骤4：重启应用
```bash
mvn spring-boot:run
```

### 步骤5：测试
发送验证码请求，查看控制台日志：
- ✅ 如果看到 "短信发送成功"，说明配置正确
- ❌ 如果看到错误信息，检查配置是否正确

## 配置参数说明

| 参数 | 说明 | 示例 |
|------|------|------|
| `enabled` | 是否启用短信服务 | `true` |
| `access-key-id` | 阿里云AccessKey ID | `LTAI5t...` |
| `access-key-secret` | 阿里云AccessKey Secret | `xxx...` |
| `sign-name` | 短信签名（需审核通过） | `智慧生态旅游平台` |
| `template-code` | 短信模板代码（需审核通过） | `SMS_123456789` |

## 注意事项

1. **签名和模板必须审核通过才能使用**
2. **AccessKey Secret不要泄露**
3. **确保账户有足够余额**
4. **未配置时会自动降级为模拟发送（控制台打印）**

## 测试账号（开发环境）

如果暂时没有阿里云账号，可以：
1. 先使用模拟发送（`enabled: false`）
2. 查看控制台输出的验证码进行测试
3. 等签名和模板审核通过后再启用真实发送

## 常见错误

### 错误1：InvalidAccessKeyId
- **原因**：AccessKey ID配置错误
- **解决**：检查AccessKey ID是否正确

### 错误2：SignatureDoesNotMatch
- **原因**：AccessKey Secret配置错误
- **解决**：检查AccessKey Secret是否正确

### 错误3：InvalidSignName
- **原因**：签名未审核通过或签名名称错误
- **解决**：检查签名是否审核通过，签名名称是否匹配

### 错误4：InvalidTemplateCode
- **原因**：模板未审核通过或模板代码错误
- **解决**：检查模板是否审核通过，模板代码是否正确

### 错误5：InsufficientBalance
- **原因**：账户余额不足
- **解决**：充值后重试










